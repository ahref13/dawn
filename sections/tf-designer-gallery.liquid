{% comment %} THE FALL â€“ Designer Gallery - Tailwind {% endcomment %}

<section class="w-full">
    <!-- Hero Image with Overlay -->
    <div class="relative w-full h-[120vh]">
        {% if page.metafields.custom.designer_thumbnail %}
            {{ page.metafields.custom.designer_thumbnail | image_url: width: 2400 | image_tag: class: 'absolute inset-0 w-full h-full object-cover', loading: 'eager' }}
        {% endif %}

        <!-- Title - Absolutely Centered -->
        <div class="absolute inset-0 flex items-center justify-center -mt-[200px]">
            <h1 class="font-xl tracking-[0.06em] text-white [mix-blend-mode:difference] leading-none text-center">
                {{ page.title }}
            </h1>
        </div>

        <!-- Description Text - Bottom Right Grid -->
        <div class="absolute inset-0 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 px-[20px] md:px-[30px] lg:px-[50px] gap-[15px] md:gap-[20px] lg:gap-[40px] pointer-events-none">
            {% if page.metafields.custom.designer_description %}
                <div class="col-span-2 md:col-span-4 md:col-start-1 lg:col-span-3 lg:col-start-4 xl:col-span-4 xl:col-start-5 self-end pb-12 text-white pointer-events-auto">
                    <p class="mb-20 leading-relaxed [mix-blend-mode:difference]">
                        {{ page.metafields.custom.designer_description | newline_to_br }}
                    </p>
                </div>
            {% endif %}
        </div>
    </div>


    <!-- Gallery Grid -->
    <div class="w-full grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-12 auto-rows-min px-[20px] md:px-[30px] lg:px-[50px] gap-[15px] md:gap-[20px] lg:gap-[40px] py-5 pb-[60px] pt-30 bg-[#F4F0E3]">
        {% for item in page.metafields.custom.designer_gallery_image.value %}
            <div class="col-span-1 xl:col-span-2 text-center no-underline text-inherit flex flex-col items-center lg:-mt-[20px]">
                {% if item.image %}
                    <img
                            src="{{ item.image | image_url: width: 500 }}"
                            alt="{{ item.title }}"
                            class="w-full aspect-[242/346] object-cover block cursor-pointer hover:opacity-90 transition-opacity"
                            loading="lazy"
                            onclick="openLightbox({{ forloop.index0 }})"
                    >
                {% endif %}
                <div class="mt-3 flex w-full items-start text-[14px] font-medium leading-[1.4]">
                    {{ item.title }}
                </div>
            </div>
        {% endfor %}
    </div>

    <!-- Lightbox Modal -->
    <div id="lightbox" class="fixed inset-0 bg-opacity-10 backdrop-blur-md hidden items-center justify-center z-100">
        <!-- Image Container -->
        <div class="max-w-[90vw] max-h-[90vh] flex items-center justify-center">
            <img id="lightbox-image" src="" alt="" class="max-w-full max-h-[90vh] object-contain transition-opacity duration-300 opacity-100">
        </div>
    </div>
</section>

<script>
  // Gallery images data
  const galleryImages = [
      {% for item in page.metafields.custom.designer_gallery_image.value %}
    {
      src: "{{ item.image | image_url: width: 2000 }}",
      title: "{{ item.title | escape }}"
    }{% unless forloop.last %},{% endunless %}
      {% endfor %}
  ];

  let currentImageIndex = 0;

  function openLightbox(index) {
    currentImageIndex = index;
    const lightbox = document.getElementById('lightbox');
    const lightboxImage = document.getElementById('lightbox-image');

    lightboxImage.src = galleryImages[currentImageIndex].src;
    lightboxImage.alt = galleryImages[currentImageIndex].title;

    lightbox.classList.remove('hidden');
    lightbox.classList.add('flex');
    document.body.style.overflow = 'hidden';
  }

  function closeLightbox() {
    const lightbox = document.getElementById('lightbox');
    const lightboxImage = document.getElementById('lightbox-image');

    lightbox.classList.add('hidden');
    lightbox.classList.remove('flex');
    document.body.style.overflow = 'auto';

    // Clear the image src and alt
    lightboxImage.src = '';
    lightboxImage.alt = '';

    lightboxImage.classList.add('opacity-0');
    setTimeout(() => {
      lightboxImage.src = '';
      lightboxImage.alt = '';
      lightboxImage.classList.remove('opacity-0');
    }, 300);

  }


  function changeImage(direction) {
    currentImageIndex += direction;

    // Loop around
    if (currentImageIndex < 0) {
      currentImageIndex = galleryImages.length - 1;
    } else if (currentImageIndex >= galleryImages.length) {
      currentImageIndex = 0;
    }

    const lightboxImage = document.getElementById('lightbox-image');

    lightboxImage.src = galleryImages[currentImageIndex].src;
    lightboxImage.alt = galleryImages[currentImageIndex].title;
  }

  // Keyboard navigation
  document.addEventListener('keydown', function(e) {
    const lightbox = document.getElementById('lightbox');
    if (!lightbox.classList.contains('hidden')) {
      if (e.key === 'Escape') {
        closeLightbox();
      } else if (e.key === 'ArrowLeft') {
        changeImage(-1);
      } else if (e.key === 'ArrowRight') {
        changeImage(1);
      }
    }
  });

  // Close on background click
  document.getElementById('lightbox').addEventListener('click', function(e) {
    if (e.target === this) {
      closeLightbox();
    }
  });
</script>